# ============================================================
# Prod config: ~4 vCPU, 16 GiB RAM
# ============================================================

# Memory settings
shared_buffers                 = '4GB'     # ~25% of RAM
effective_cache_size           = '12GB'    # planner hint (~75% of RAM)
work_mem                       = '64MB'    # per sort/hash operation (watch concurrent queries)
maintenance_work_mem           = '1GB'     # VACUUM, CREATE INDEX, etc.

# Connections
max_connections                = 100       # assume PgBouncer / sane pooling

# WAL / checkpoints
max_wal_size                   = '4GB'
checkpoint_timeout             = '15min'

# Autovacuum
autovacuum_vacuum_scale_factor  = 0.02
autovacuum_analyze_scale_factor = 0.02

# Extensions: pg_stat_statements
shared_preload_libraries       = 'pg_stat_statements'
# pg_stat_statements tuning
pg_stat_statements.max         = 20000     # track more distinct statements in prod
pg_stat_statements.track       = 'all'
pg_stat_statements.save        = on

# Logging / diagnostics
log_min_duration_statement     = '200ms'   # log queries slower than 200ms
log_checkpoints                = on
log_autovacuum_min_duration    = '500ms'   # log autovacuum runs > 0.5s
track_io_timing                = on        # enables per-query I/O timing (small overhead)

