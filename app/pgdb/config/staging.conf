# ============================================================
# Staging config: ~2 vCPU, 8 GiB RAM
# ============================================================

# Memory settings
shared_buffers                 = '2GB'    # ~25% of RAM
effective_cache_size           = '6GB'    # planner hint (~75% of RAM)
work_mem                       = '32MB'   # per sort/hash operation
maintenance_work_mem           = '512MB'  # VACUUM, CREATE INDEX, etc.

# Connections
max_connections                = 100      # staging: app + k6 + psql

# WAL / checkpoints
max_wal_size                   = '2GB'
checkpoint_timeout             = '15min'

# Autovacuum
autovacuum_vacuum_scale_factor  = 0.05
autovacuum_analyze_scale_factor = 0.05

# Extensions: pg_stat_statements
shared_preload_libraries       = 'pg_stat_statements'
# pg_stat_statements tuning
pg_stat_statements.max         = 10000    # more statements in staging
pg_stat_statements.track       = 'all'
pg_stat_statements.save        = on

# Logging / debugging
log_min_duration_statement     = '200ms'  # tighter than dev for perf testing
log_checkpoints                = on
log_autovacuum_min_duration    = '1000ms' # log autovacuum runs > 1s

# Track I/O timing for deeper analysis
track_io_timing                = on
